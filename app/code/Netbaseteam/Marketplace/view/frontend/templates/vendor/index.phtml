<?php
$helper = $this->helper('Netbaseteam\Marketplace\Helper\Data');

$isVacation = $helper->isVacation();
$isLocator = $helper->isLocatorEnable();

$shopData = $block->getShopData();
$shopID = isset($shopData['shop_id']) ? $shopData['shop_id']: '';
$notifications = $block->getNotifications();
?>
<div>
    <div class="container body">
        <div class="main_container">
            <div class="col-md-3 left_col">
                <div class="left_col scroll-view">
                    <div class="navbar nav_title" style="border: 0;">
                        <a href="<?php echo $this->getUrl("marketplace/vendor/", ['_secure' => $this->getRequest()->isSecure()]); ?>" class="site_title"><i class="fa fa-user"></i> <span>Vendor Panel</span></a>
                    </div>

                    <div class="clearfix"></div>

                    <!-- menu profile quick info -->
                    <div class="profile clearfix">
                        <div class="profile_pic">
                            <img src="<?php echo $helper->getMediaUrl().'marketplace/'.(isset($shopData['shop_logo']) ? $shopData['shop_logo'] : 'no-images.png'); ?>" alt="..." class="img-circle profile_img">
                        </div>
                        <div class="profile_info">
                            <span>Welcome,</span>
                            <h2><?php echo isset($shopData['shop_title']) ? $shopData['shop_title']: 'Shop Name'?></h2>
                        </div>
                    </div>
                    <!-- /menu profile quick info -->

                    <br />

                    <!-- sidebar menu -->
                    <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
                        <div class="menu_section">
                            <h3>General</h3>
                            <ul class="nav side-menu">
                                <li><a><i class="fa fa-home"></i> Home <span class="fa fa-chevron-down"></span></a>
                                    <ul class="nav child_menu">
                                        <li><a href="<?php echo $this->getUrl("marketplace/vendor/", ['_secure' => $this->getRequest()->isSecure()]); ?>">Dashboard</a></li>
                                    </ul>
                                </li>
                                <li><a><i class="fa fa-bar-chart-o"></i> Sales <span class="fa fa-chevron-down"></span></a>
                                    <ul class="nav child_menu">
                                        <li><a href="<?php echo $this->getUrl("marketplace/sales/order", ['_secure' => $this->getRequest()->isSecure()]); ?>">Manage Orders</a></li>
                                        <li><a href="<?php echo $this->getUrl("marketplace/sales/report", ['_secure' => $this->getRequest()->isSecure()]); ?>">Sales Report</a></li>
                                    </ul>
                                </li>
                                <li><a><i class="fa fa-cubes"></i> Products <span class="fa fa-chevron-down"></span></a>
                                    <ul class="nav child_menu">
                                        <li><a href="<?php echo $this->getUrl("marketplace/product/", ['_secure' => $this->getRequest()->isSecure()]); ?>">Manage Products</a></li>
<!--                                        <li><a href="--><?php //echo $this->getUrl("marketplace/product_attribute/new/", ['_secure' => $this->getRequest()->isSecure()]); ?><!--">Product Attributes</a></li>-->
                                    </ul>
                                </li>
                                <li><a><i class="fa fa-exchange"></i>Transactions <span class="fa fa-chevron-down"></span></a>
                                    <ul class="nav child_menu">
                                        <li><a href="<?php echo $this->getUrl('marketplace/transaction/listtransaction/', ['_secure' => $this->getRequest()->isSecure()]); ?>">List Transactions</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        <div class="menu_section">
                            <h3>Design</h3>
                            <ul class="nav side-menu">
                                <li><a><i class="fa fa-shopping-cart"></i> Landing Page <span class="fa fa-chevron-down"></span></a>
                                    <ul class="nav child_menu">
                                        <li><a href="<?php echo $this->getUrl("marketplace/seller/profile/shop/$shopID", ['_secure' => $this->getRequest()->isSecure()]); ?>">Go To Shop</a></li>
                                        <li><a href="<?php echo $this->getUrl("marketplace/seller/editprofile", ['_secure' => $this->getRequest()->isSecure()]); ?>">Profile</a></li>
                                    </ul>
                                </li>
                                <li><a href="javascript:void(0)"><i class="fa fa-institution"></i> Builder <span class="label label-success pull-right">Coming Soon</span></a></li>
                            </ul>
                        </div>
                        <div class="menu_section">
                            <h3>Addons</h3>
                            <ul class="nav side-menu">
                                <?php if($isVacation):?>
                                    <li><a><i class="fa fa-umbrella"></i> Vacations <span class="fa fa-chevron-down"></span></a>
                                        <ul class="nav child_menu">
                                            <li><a href="<?php echo $this->getUrl("marketplace/vacation/index", ['_secure' => $this->getRequest()->isSecure()]); ?>">Settings</a></li>
                                        </ul>
                                    </li>
                                <?php endif;?>
                                <?php if($isLocator):?>
                                    <li><a><i class="fa fa-map-marker"></i> Locations <span class="fa fa-chevron-down"></span></a>
                                        <ul class="nav child_menu">
                                            <li><a href="<?php echo $this->getUrl("marketplace/locator/listlocator", ['_secure' => $this->getRequest()->isSecure()]); ?>">Manage Locators</a></li>
                                            <li><a href="<?php echo $this->getUrl("marketplace/locator/add", ['_secure' => $this->getRequest()->isSecure()]); ?>">New Locator</a></li>
                                        </ul>
                                    </li>
                                <?php endif;?>
                                <!-- <li><a><i class="fa fa-group"></i> Memberships <span class="fa fa-chevron-down"></span></a>
                                  <ul class="nav child_menu">
                                    <li><a href="pricing_tables.html">Pricing Memberships</a></li>
                                  </ul>
                                </li> -->
                                <li><a href="javascript:void(0)"><i class="fa fa-group"></i> Memberships <span class="label label-success pull-right">Coming Soon</span></a></li>
                            </ul>
                        </div>

                    </div>
                    <!-- /sidebar menu -->

                    <!-- /menu footer buttons -->
                    <div class="sidebar-footer hidden-small">
                        <a data-toggle="tooltip" data-placement="top" title="Settings">
                            <span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
                        </a>
                        <a href="#" data-toggle="tooltip" data-placement="top" title="FullScreen" id="fullscreen_link">
                            <span class="glyphicon glyphicon-fullscreen" aria-hidden="true"></span>
                        </a>
                        <a data-toggle="tooltip" data-placement="top" title="Lock">
                            <span class="glyphicon glyphicon-eye-close" aria-hidden="true"></span>
                        </a>
                        <a data-toggle="tooltip" data-placement="top" title="Logout" href="<?php echo $this->getUrl("customer/account/logout", ['_secure' => $this->getRequest()->isSecure()]); ?>">
                            <span class="glyphicon glyphicon-off" aria-hidden="true"></span>
                        </a>
                    </div>
                    <!-- /menu footer buttons -->
                </div>
            </div>

            <!-- top navigation -->
            <div class="top_nav">
                <div class="nav_menu">
                    <nav>
                        <div class="nav toggle">
                            <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                        </div>

                        <ul class="nav navbar-nav navbar-right">
                            <li class="">
                                <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                    <img src="<?php echo $helper->getMediaUrl().'marketplace/'.(isset($shopData['shop_logo']) ? $shopData['shop_logo'] : 'no-images.png'); ?>" alt=""><?php echo isset($shopData['shop_title']) ? $shopData['shop_title']: 'Shop Name'?>
                                    <span class=" fa fa-angle-down"></span>
                                </a>
                                <ul class="dropdown-menu dropdown-usermenu pull-right">
                                    <li><a href="<?php echo $this->getUrl("marketplace/seller/editprofile", ['_secure' => $this->getRequest()->isSecure()]); ?>"> Profile</a></li>
                                    <li><a href="https://netbaseteam.net/support_ticket/">Help</a></li>
                                    <li><a href="<?php echo $this->getUrl("customer/account/logout", ['_secure' => $this->getRequest()->isSecure()]); ?>"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                                </ul>
                            </li>

                            <li role="presentation" class="dropdown">
                                <a href="javascript:;" class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="true">
                                    <i class="fa fa-envelope-o"></i>
                                    <span class="badge bg-green"><?=count($notifications) ? count($notifications) : ''?></span>
                                </a>
                                <ul id="menu1" class="dropdown-menu dropdown-menu-messenger list-unstyled msg_list" role="menu">
                                    <?php if(count($notifications)):?>
                                        <?php foreach($notifications as $noti):?>
                                        <li>
                                            <a href="<?=$noti->getUrl()?>">
                                                <!-- <span class="image"><img src="" alt="Profile Image" /></span> -->
                                                <span>
                                                    <span><?=$noti->getTitle()?></span>
                                                    <span class="time"><?php echo $formatDate =  date(("F j, Y, g:i a"), strtotime($noti->getCreatedAt())); ?></span>
                                                </span>
                                                <span class="message">
                                                    <?php echo $noti->getDescription()?>
                                                </span>
                                            </a>
                                            <a href="<?=$this->getUrl('marketplace/notification/ajaxMarkAsRead')?>" class="notifications-close-button" data-id="<?=$noti->getId()?>"><i class="notifications-close fa fa-times-circle"></i></a>
                                        </li>
                                        <?php endforeach;?>
                                    <?php else:?>
                                        <li>
                                            <div class="text-center">
                                                <a>
                                                    <strong>Great! You've read all the messages in your inbox.</strong>
                                                </a>
                                            </div>
                                        </li>
                                    <?php endif;?>
                                    <li class="see-all">
                                        <div class="text-center">
                                            <a href="<?=$this->getUrl('marketplace/notification/index')?>">
                                                <strong>See All Alerts<?php echo count($notifications) ? ' ('.count($notifications) .' unread)' : ''?></strong>
                                                <i class="fa fa-angle-right"></i>
                                            </a>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="<?php echo $this->getUrl("marketplace/seller/profile/shop/$shopID", ['_secure' => $this->getRequest()->isSecure()]); ?>" class="dropdown-toggle" target="_blank" title="Home Page">
                                    <i class="fa fa-home">&nbsp;</i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
            <!-- /top navigation -->

            <!-- page content -->
            <?php echo $block->getChildHtml();?>
            <!-- /page content -->

        </div>
    </div>
</div>
<script type="text/javascript">
    require([
        'jquery',
        'Netbaseteam_Marketplace/js/lib/jquery.fullscreen'
    ], function ($) {
        $(document).ready(function(){
            $("body").on('click',"#fullscreen_link", function(){
                $(document).toggleFullScreen();
            });
            if($('.popup-for-right').hasClass('in')){
                $('.span.notification-bell__mentions').css('display','none');
            }else{
                $('.span.notification-bell__mentions').css('display','inline-block');
            }
            $("body").on('click',".notifications-close-button", function(e){
                e.preventDefault();
                e.stopPropagation();
                var self = $(this);
                var url = self.attr('href');
                var id = self.attr('data-id');
                var count = $('a.dropdown-toggle.info-number .badge').text();
                $.ajax({
                    url: url,
                    data: {id:id},
                    type: 'post',
                    beforeSend: function () {
                        self.closest('li').fadeOut();
                        if (count>1) {
                            $('a.dropdown-toggle.info-number .badge').text(count-1);
                        } else {
                            $('a.dropdown-toggle.info-number .badge').text('');
                            $('.see-all strong').text('See All Alerts');
                            $('#menu1').prepend("<li> <div class='text-center'> <a> <strong>Great! You've read all the messages in your inbox.</strong> </a> </div></li>");
                        }
                    },
                    success: function () {
                    },
                    error: function () {
                        window.location.reload();
                    }
                });
            });
        });
    });
</script>
